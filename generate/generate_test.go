// MIT License
//
// Copyright (c) 2020 goctl-android
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.

package generate

import (
	"encoding/json"
	"testing"

	"github.com/stretchr/testify/assert"
)

var pluginJson = "{\"Api\":{\"Info\":{\"Title\":\"\",\"Desc\":\"\",\"Version\":\"\",\"Author\":\"\",\"Email\":\"\"},\"Types\":[{\"Name\":\"LoginReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Username\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"username\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Password\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"password\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},{\"Name\":\"RegisterReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Username\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"username\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Password\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"password\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Mobile\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"mobile\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},{\"Name\":\"UserInfoReply\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Name\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"name\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Age\",\"Type\":\"int\",\"Expr\":{\"StringExpr\":\"int\",\"Name\":\"int\"},\"Tag\":\"`json:\\\"age\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Birthday\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"birthday\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Description\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"description\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Tag\",\"Type\":\"[]string\",\"Expr\":{\"StringExpr\":\"[]string\",\"ArrayType\":{\"StringExpr\":\"string\",\"Name\":\"string\"}},\"Tag\":\"`json:\\\"tag\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},{\"Name\":\"UserInfoReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Id\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`path:\\\"id\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},{\"Name\":\"UserSearchReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"KeyWord\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`form:\\\"keyWord\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]}],\"Service\":{\"Name\":\"user-api\",\"Groups\":[{\"Annotations\":null,\"Routes\":[{\"Annotations\":[{\"Name\":\"doc\",\"Properties\":{\"summary\":\"\\\"注册\\\"\"},\"Value\":\"\"},{\"Name\":\"handler\",\"Properties\":null,\"Value\":\"register\"}],\"Method\":\"post\",\"Path\":\"/api/user/register\",\"RequestType\":{\"Name\":\"RegisterReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Username\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"username\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Password\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"password\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Mobile\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"mobile\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},\"ResponseType\":{\"Name\":\"\",\"Annotations\":null,\"Members\":null}},{\"Annotations\":[{\"Name\":\"doc\",\"Properties\":{\"summary\":\"登录\"},\"Value\":\"\"},{\"Name\":\"handler\",\"Properties\":null,\"Value\":\"login\"}],\"Method\":\"post\",\"Path\":\"/api/user/login\",\"RequestType\":{\"Name\":\"LoginReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Username\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"username\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Password\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"password\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},\"ResponseType\":{\"Name\":\"\",\"Annotations\":null,\"Members\":null}},{\"Annotations\":[{\"Name\":\"doc\",\"Properties\":{\"summary\":\"\\\"获取用户信息\\\"\"},\"Value\":\"\"},{\"Name\":\"handler\",\"Pros\":null,\"Value\":\"getUserInfo\"}],\"Method\":\"get\",\"Path\":\"/api/user/:id\",\"RequestType\":{\"Name\":\"UserInfoReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Id\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`path:\\\"id\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},\"ResponseType\":{\"Name\":\"UserInfoReply\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Name\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"name\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Age\",\"Type\":\"int\",\"Expr\":{\"StringExpr\":\"int\",\"Name\":\"int\"},\"Tag\":\"`json:\\\"age\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Birthday\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"birthday\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Description\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"description\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Tag\",\"Type\":\"[]string\",\"Expr\":{\"StringExpr\":\"[]string\",\"ArrayType\":{\"StringExpr\":\"string\",\"Name\":\"string\"}},\"Tag\":\"`json:\\\"tag\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]}},{\"Annotations\":[{\"Name\":\"doc\",\"Properties\":{\"summary\":\"\\\"用户搜索\\\"\"},\"Value\":\"\"},{\"Name\":\"handler\",\"Propes\":null,\"Value\":\"searchUser\"}],\"Method\":\"get\",\"Path\":\"/api/user/search\",\"RequestType\":{\"Name\":\"UserSearchReq\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"KeyWord\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`form:\\\"keyWord\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]},\"ResponseType\":{\"Name\":\"UserInfoReply\",\"Annotations\":null,\"Members\":[{\"Annotations\":null,\"Name\":\"Name\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"name\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Age\",\"Type\":\"int\",\"Expr\":{\"StringExpr\":\"int\",\"Name\":\"int\"},\"Tag\":\"`json:\\\"age\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Birthday\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"birthday\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Description\",\"Type\":\"string\",\"Expr\":{\"StringExpr\":\"string\",\"Name\":\"string\"},\"Tag\":\"`json:\\\"description\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false},{\"Annotations\":null,\"Name\":\"Tag\",\"Type\":\"[]string\",\"Expr\":{\"StringExpr\":\"[]string\",\"ArrayType\":{\"StringExpr\":\"string\",\"Name\":\"string\"}},\"Tag\":\"`json:\\\"tag\\\"`\",\"Comment\":\"\",\"Comments\":null,\"Docs\":null,\"IsInline\":false}]}}]}]}},\"Style\":\"\",\"Dir\":\"/Users/anqiansong/workspace/java/ClientCall/src/main/java/com/tal\"}"

func TestDo(t *testing.T) {
	var plugin Plugin
	err := json.Unmarshal([]byte(pluginJson), &plugin)
	assert.Nil(t, err)

	plugin.Dir = t.TempDir()
	plugin.ParentPackage = "com.gozero"
	assert.Nil(t, Do(plugin))
}
